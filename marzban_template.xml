<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
    <version>7.0</version>
    <template_groups>
        <template_group>
            <uuid>a571c0d144b14fd4a87a9d9b2aa9fcd6</uuid>
            <name>Templates/Applications</name>
        </template_group>
    </template_groups>
    <templates>
        <template>
            <uuid>8c5584d871ca42e48ce8d12044c132ac</uuid>
            <template>Marzban</template>
            <name>Marzban</name>
            <groups>
                <group>
                    <name>Templates/Applications</name>
                </group>
            </groups>
            <items>
                <item>
                    <uuid>4ee8dc3f74224e75a1af713a9820baf9</uuid>
                    <name>Marzban | Get application metrics</name>
                    <type>HTTP_AGENT</type>
                    <key>marzban.get.metrics</key>
                    <history>0</history>
                    <value_type>TEXT</value_type>
                    <trends>0</trends>
                    <url>{$MARZBAN:IP}:{$MARZBAN:METRICS_PORT}{$MARZBAN:METRICS_PATH}</url>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>Marzban</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>901e7723dd6e4aba94623e5577c3be43</uuid>
                    <name>Marzban | All incoming bandwidth</name>
                    <type>DEPENDENT</type>
                    <key>marzban.marzban_all_incoming_bandwidth</key>
                    <delay>0</delay>
                    <units>B</units>
                    <preprocessing>
                        <step>
                            <type>PROMETHEUS_PATTERN</type>
                            <parameters>
                                <parameter>marzban_all_incoming_bandwidth</parameter>
                                <parameter>value</parameter>
                                <parameter/>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>marzban.get.metrics</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>Marzban</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>9c0768b85f3a4486aa21b3d0fb301d61</uuid>
                    <name>Marzban | All outgoing bandwidth</name>
                    <type>DEPENDENT</type>
                    <key>marzban.marzban_all_outgoing_bandwidth</key>
                    <delay>0</delay>
                    <units>B</units>
                    <preprocessing>
                        <step>
                            <type>PROMETHEUS_PATTERN</type>
                            <parameters>
                                <parameter>marzban_all_outgoing_bandwidth</parameter>
                                <parameter>value</parameter>
                                <parameter/>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>marzban.get.metrics</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>Marzban</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>3a01c2b1239d4a0890c14f1a75967833</uuid>
                    <name>Marzban | Total number of users</name>
                    <type>DEPENDENT</type>
                    <key>marzban.marzban_panel_total_users</key>
                    <delay>0</delay>
                    <preprocessing>
                        <step>
                            <type>PROMETHEUS_PATTERN</type>
                            <parameters>
                                <parameter>marzban_panel_total_users</parameter>
                                <parameter>value</parameter>
                                <parameter/>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>marzban.get.metrics</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>Marzban</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>aa07f4f2ed3c414892fa17e803cc04e0</uuid>
                    <name>Marzban | Active number of users</name>
                    <type>DEPENDENT</type>
                    <key>marzban.marzban_panel_users_active</key>
                    <delay>0</delay>
                    <preprocessing>
                        <step>
                            <type>PROMETHEUS_PATTERN</type>
                            <parameters>
                                <parameter>marzban_panel_users_active</parameter>
                                <parameter>value</parameter>
                                <parameter/>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>marzban.get.metrics</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>Application</tag>
                            <value>Marzban</value>
                        </tag>
                    </tags>
                </item>
            </items>
            <discovery_rules>
                <discovery_rule>
                    <uuid>d9ca38d152fd49cc894cf2f4ad211a8b</uuid>
                    <name>Marzban | Dynamic monitoring by user</name>
                    <type>DEPENDENT</type>
                    <key>marzban.dynamic.monitoring.by.user</key>
                    <delay>0</delay>
                    <item_prototypes>
                        <item_prototype>
                            <uuid>f2b57a1bc25c4b0f866617de4f7342f4</uuid>
                            <name>Marzban | {#USERNAME} online status</name>
                            <type>DEPENDENT</type>
                            <key>marzban.marzban_user_online[{#USERNAME}]</key>
                            <delay>0</delay>
                            <preprocessing>
                                <step>
                                    <type>PROMETHEUS_PATTERN</type>
                                    <parameters>
                                        <parameter>marzban_user_online{username=&quot;{#USERNAME}&quot;}</parameter>
                                        <parameter>value</parameter>
                                        <parameter/>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>marzban.get.metrics</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>Marzban</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>1ea466769cfe4cbb892a167f03d8b7bd</uuid>
                            <name>Marzban | {#USERNAME} used traffic</name>
                            <type>DEPENDENT</type>
                            <key>marzban.marzban_user_used_traffic[{#USERNAME}]</key>
                            <delay>0</delay>
                            <units>B</units>
                            <preprocessing>
                                <step>
                                    <type>PROMETHEUS_PATTERN</type>
                                    <parameters>
                                        <parameter>marzban_user_used_traffic{username=&quot;{#USERNAME}&quot;}</parameter>
                                        <parameter>value</parameter>
                                        <parameter/>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>marzban.get.metrics</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>Application</tag>
                                    <value>Marzban</value>
                                </tag>
                            </tags>
                        </item_prototype>
                    </item_prototypes>
                    <master_item>
                        <key>marzban.get.metrics</key>
                    </master_item>
                    <lld_macro_paths>
                        <lld_macro_path>
                            <lld_macro>{#USERNAME}</lld_macro>
                            <path>$.labels.username</path>
                        </lld_macro_path>
                    </lld_macro_paths>
                    <preprocessing>
                        <step>
                            <type>PROMETHEUS_TO_JSON</type>
                            <parameters>
                                <parameter>marzban_user_online</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.[*]</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                </discovery_rule>
            </discovery_rules>
            <tags>
                <tag>
                    <tag>Application</tag>
                    <value>Marzban</value>
                </tag>
            </tags>
            <macros>
                <macro>
                    <macro>{$MARZBAN:METRICS_PATH}</macro>
                    <value>/metrics</value>
                    <description>In most cases it is /metrics</description>
                </macro>
            </macros>
        </template>
    </templates>
</zabbix_export>
